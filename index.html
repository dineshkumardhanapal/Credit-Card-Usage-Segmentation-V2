<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Credit Card Customer Segmentation</title>
    <script src="https://cdn.plotly.com/plotly-latest.min.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; }
        .container { display: flex; gap: 20px; }
        .chart-container { flex: 1; }
        .profile-container { flex: 1; }
        .profile-details { border: 1px solid #ccc; padding: 10px; }
    </style>
</head>
<body>
    <h1>Credit Card Customer Segmentation</h1>
    <h2>Interactive Dashboard to Explore Customer Personas</h2>

    <div class="container">
        <div class="chart-container">
            <h3>Customer Segments (PCA Visualization)</h3>
            <p>Click on a data point to view the customer's profile.</p>
            <div id="pcaChart"></div>
        </div>

        <div class="profile-container">
            <h3>Segment Profile</h3>
            <div class="profile-details">
                <p><strong>Select a Customer</strong></p>
                <p>Click on a point in the chart to see details here.</p>
                <p><strong>Customer ID:</strong> <span id="custId"></span></p>
                <p><strong>Balance:</strong> <span id="balance"></span></p>
                <p><strong>Purchases:</strong> <span id="purchases"></span></p>
                <p><strong>Credit Usage Ratio:</strong> <span id="creditUsage"></span></p>
                <p><strong>Cluster:</strong> <span id="cluster"></span></p>
            </div>
        </div>
    </div>

    <script>
        // Load the CSV file
        d3.csv('customer_segments_for_dashboard.csv').then(data => {
            // Convert string numbers to float
            data.forEach(d => {
                d.PC1 = +d.PC1;
                d.PC2 = +d.PC2;
                d.Cluster = +d.Cluster;
                d.BALANCE = +d.BALANCE;
                d.PURCHASES = +d.PURCHASES;
                d.CREDIT_USAGE_RATIO = +d.CREDIT_USAGE_RATIO;
            });

            // Prepare trace for Plotly
            const trace = {
                x: data.map(d => d.PC1),
                y: data.map(d => d.PC2),
                mode: 'markers',
                type: 'scatter',
                text: data.map(d => `ID: ${d.CUST_ID}<br>Balance: $${d.BALANCE.toFixed(2)}<br>Purchases: $${d.PURCHASES.toFixed(2)}<br>Ratio: ${d.CREDIT_USAGE_RATIO.toFixed(2)}`),
                marker: { size: 10, color: data.map(d => d.Cluster), colorscale: 'Viridis' }
            };

            const layout = {
                title: 'Customer Segments (PCA Visualization)',
                xaxis: { title: 'PC1' },
                yaxis: { title: 'PC2' }
            };

            Plotly.newPlot('pcaChart', [trace], layout);

            // Click event to update profile
            document.getElementById('pcaChart').on('plotly_click', function(data) {
                const point = data.points[0];
                const index = point.pointNumber;
                document.getElementById('custId').textContent = data[index].CUST_ID || 'N/A';
                document.getElementById('balance').textContent = `$${data[index].BALANCE.toFixed(2)}` || 'N/A';
                document.getElementById('purchases').textContent = `$${data[index].PURCHASES.toFixed(2)}` || 'N/A';
                document.getElementById('creditUsage').textContent = `${data[index].CREDIT_USAGE_RATIO.toFixed(2)}` || 'N/A';
                document.getElementById('cluster').textContent = data[index].Cluster || 'N/A';
            });
        }).catch(error => console.error('Error loading CSV:', error));
    </script>
</body>
</html>